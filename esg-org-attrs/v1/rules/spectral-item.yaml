extends: "spectral:oas"
functions:
  - ./functions/matchItemId.js

rules:
  item-attrs-context-correct:
    description: "@context must point to the merged pack context"
    given: "$.beckn:itemAttributes"
    then:
      field: "@context"
      function: pattern
      functionOptions:
        match: "^https://schema\.example\.org/mixed/esg-org-attrs/v1/context\.jsonld$"

  item-attrs-type-correct:
    description: "@type must be esg:MetricAttributes"
    given: "$.beckn:itemAttributes"
    then:
      field: "@type"
      function: pattern
      functionOptions:
        match: "^esg:MetricAttributes$"

  metricId-must-equal-item-id:
    description: "itemAttributes.metricId must equal Item.beckn:id"
    severity: error
    given: "$"
    then:
      function: matchItemId
      functionOptions:
        itemIdPath: "beckn:id"
        metricIdPath: "beckn:itemAttributes.metricId"

  unit-should-be-known:
    description: "Prefer known unit codes (warning only)"
    severity: warn
    given: "$.beckn:itemAttributes.unit"
    then:
      function: pattern
      functionOptions:
        match: "^(tCO2e|m3|PPM)$"

  reporting-period-dates:
    description: "reportingPeriod.start and end must look like dates"
    severity: warn
    given: "$.beckn:itemAttributes.reportingPeriod"
    then:
      function: schema
      functionOptions:
        schema:
          type: object
          properties:
            start: { type: string, pattern: "^\d{4}-\d{2}-\d{2}$" }
            end:   { type: string, pattern: "^\d{4}-\d{2}-\d{2}$" }
