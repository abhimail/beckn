extends: "spectral:oas"
rules:
  provider-attrs-context-correct:
    description: "@context must point to the merged pack context"
    given: "$.beckn:provider.beckn:providerAttributes"
    then:
      field: "@context"
      function: pattern
      functionOptions:
        match: "^https://schema\.example\.org/mixed/esg-org-attrs/v1/context\.jsonld$"

  provider-attrs-type-correct:
    description: "@type must be org:ProviderAttributes"
    given: "$.beckn:provider.beckn:providerAttributes"
    then:
      field: "@type"
      function: pattern
      functionOptions:
        match: "^org:ProviderAttributes$"

  provider-identifiers-patterns:
    description: "Identifier formats should match known patterns"
    severity: warn
    given: "$.beckn:provider.beckn:providerAttributes.identifiers"
    then:
      - field: leiNumber
        function: pattern
        functionOptions: { match: "^[A-Z0-9]{18}[0-9]{2}$" }
      - field: gstNumber
        function: pattern
        functionOptions: { match: "^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$" }
      - field: isin
        function: pattern
        functionOptions: { match: "^[A-Z]{2}[A-Z0-9]{9}[0-9]$" }
      - field: cusip
        function: pattern
        functionOptions: { match: "^[0-9A-Z]{9}$" }

  provider-year-range:
    description: "yearOfIncorporation should be a plausible year"
    severity: warn
    given: "$.beckn:provider.beckn:providerAttributes.yearOfIncorporation"
    then:
      function: schema
      functionOptions:
        schema:
          type: integer
          minimum: 1800
          maximum: 2100
