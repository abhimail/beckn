meta {
  name: discovery-within-a-timerange
  type: http
  seq: 7
}

get {
  url: {{cds_url}}/beckn/discover
  body: json
  auth: inherit
}

headers {
  Content-Type: application/json
}

body:json {
  {
      "context": {
          "version": "2.0.0",
          "action": "discover",
          "timestamp": "2024-01-15T10:30:00Z",
          "message_id": "bb9f86db-9a3d-4e9c-8c11-81c8f1a7b901",
          "transaction_id": "f9d1e7f3-5f1a-4d23-9f10-31b72c0b0c01",
          "bap_id": "bap.example.com",
          "bap_uri": "https://bap.example.com",
          "ttl": "PT30S",
          "schema_context": [
              "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/draft/schema/EvChargingService/v1/context.jsonld"
          ]
      },
      "message": {
          "spatial": [
              {
                  "op": "s_dwithin",
                  "targets": "$['beckn:availableAt'][*]['geo']",
                  "geometry": {
                      "type": "Point",
                      "coordinates": [
                          77.59,
                          12.94
                      ]
                  },
                  "distanceMeters": 8000
              }
          ],
          "filters": {
              "type": "jsonpath",
              "expression": "$[?(@.beckn:itemAttributes.connectorType == 'CCS2' && @.beckn:availabilityWindow.schema:startTime <= '12:30:00' && @.beckn:availabilityWindow.schema:endTime >= '14:30:00')]"
          }
      }
  }
}

settings {
  encodeUrl: true
  followRedirects: true
}
